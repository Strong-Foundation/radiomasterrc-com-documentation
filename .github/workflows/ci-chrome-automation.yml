# ğŸ¤– CI Workflow â€“ Chrome Automation, Go Runner & Auto Commit
# This GitHub Actions workflow automates:
# 1. Running a Go script (main.go) that uses non-headless Chrome
# 2. Committing any updated files automatically
# 3. Running on a schedule or manually via GitHub Actions UI

name: CI Chrome Automation & Auto Commit # ğŸŒŸ Workflow name as shown in GitHub Actions tab

on: # âš¡ Define workflow triggers
  schedule: # ğŸ•’ Schedule-based automatic runs
    - cron: "0 0 * * *" # ğŸ“… Run every day at 00:00 UTC
  workflow_dispatch: # ğŸ§  Allow manual triggering from GitHub Actions UI

permissions: # ğŸ” Workflow-wide permissions
  contents: write # âœï¸ Allow workflow to push commits to repository

jobs: # ğŸ§© Define all jobs
  chrome-go-automation: # ğŸ”§ Name of the main job
    runs-on: ubuntu-latest # ğŸ§ Use the latest Ubuntu virtual machine

    permissions: # ğŸ” Job-level permissions (redundant but explicit)
      contents: write # âœï¸ Allow writing/pushing to repo contents

    steps: # ğŸªœ Ordered steps in the job

      - name: Checkout Repository # ğŸ§± Step 1: Clone the repository
        uses: actions/checkout@v5 # ğŸ”„ Official GitHub action to checkout code
        with:
          token: ${{ secrets.GITHUB_TOKEN }} # ğŸ”‘ Use built-in token for authentication

      - name: Setup Go Environment # âš™ï¸ Step 2: Install Go
        uses: actions/setup-go@v6 # ğŸ“¦ Official Go setup action
        with:
          go-version-file: "go.mod"

      - name: Install Chrome & Xvfb # ğŸŒ Step 3: Install Chrome browser & virtual display
        run: |
          sudo apt-get update -y # ğŸ” Update Ubuntu package list
          sudo apt-get install -y xvfb # ğŸ–¥ï¸ Install X virtual framebuffer for GUI apps
          sudo apt-get install -y google-chrome-stable || true # ğŸŒ Install Chrome, ignore error if not found

      - name: Start Virtual Display # ğŸ–¥ï¸ Step 4: Start Xvfb for non-headless Chrome
        run: |
          Xvfb :99 -screen 0 1920x1080x24 & # â–¶ï¸ Start virtual framebuffer on display :99 with full HD resolution
          echo "DISPLAY=:99" >> $GITHUB_ENV # ğŸ’¡ Set DISPLAY environment variable for Chrome

      - name: Run Go Automation Script # ğŸš€ Step 5: Execute Go program
        run: go run main.go # ğŸ–¥ï¸ Run Go script (main.go) that uses Chrome automation

      - name: Commit & Push Updates # ğŸ’¾ Step 6: Commit and push changed files
        run: |
          git config --global user.name "github-actions[bot]" # ğŸ‘¤ Set Git username for commits
          git config --global user.email "github-actions[bot]@users.noreply.github.com" # ğŸ“§ Set commit email
          git pull --rebase # ğŸ” Update local branch with remote before pushing
          git add . # â• Stage all modified files
          if ! git diff --cached --quiet; then # ğŸ§  Check if there are staged changes
            git commit -m "ğŸ¤– Auto Update: $(date -u +'%Y-%m-%d %H:%M:%S UTC')" # ğŸ•’ Commit with UTC timestamp
            git push # ğŸš€ Push commits to remote repository
          else
            echo "âœ… No changes to commit." # ğŸ’¤ No changes detected
          fi # ğŸ”š End of conditional block
